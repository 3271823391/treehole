<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¿ƒçµé¿é£æ¸¯ - å°ç›ˆé™ªä½ è¯´å¿ƒé‡Œè¯</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: "Microsoft YaHei", "PingFang SC", sans-serif;
        }

        body {
            background-color: #f0f7ff;
            color: #333;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            position: relative;
            padding-bottom: 40px; /* ä¸ºåº•éƒ¨ç‰ˆæƒé¢„ç•™ç©ºé—´ */
        }

        /* é¡¶éƒ¨å¯¼èˆªæ  - ç§»é™¤AIæ ‘æ´ï¼Œç®€åŒ–æ–‡å­— */
        .header {
            background: linear-gradient(90deg, #4a90e2, #5ba0f2);
            color: #fff;
            padding: 1rem 2rem;
            text-align: center;
            box-shadow: 0 3px 15px rgba(74, 144, 226, 0.25);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header h1 {
            font-size: 1.6rem;
            font-weight: 700;
            letter-spacing: 1px;
        }

        .header p {
            font-size: 0.9rem;
            opacity: 0.95;
            margin-top: 0.4rem;
        }

        /* ä¸»å®¹å™¨ - é‡æ„å¸ƒå±€ï¼ŒèŠå¤©æ¡†å ä¸»ä½“ */
        .main-container {
            flex: 1;
            display: flex;
            max-width: 1400px;
            margin: 1.2rem auto;
            padding: 0 1rem;
            gap: 1.2rem;
            flex-wrap: wrap;
        }

        /* èŠå¤©åŒºåŸŸ - æå‡å æ¯”ï¼Œä¸»ä½“è§†è§‰ */
        .chat-section {
            flex: 4; /* èŠå¤©åŒºå 4ä»½ï¼Œä¾§è¾¹æ å 1ä»½ï¼Œä¸»ä½“æ›´çªå‡º */
            min-width: 300px;
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        /* èŠå¤©çª—å£ - ä¼˜åŒ–å†…è¾¹è·å’Œé˜´å½± */
        .chat-window {
            flex: 1;
            background-color: #fff;
            border-radius: 16px;
            padding: 1.2rem 1.5rem;
            box-shadow: 0 0 25px rgba(74, 144, 226, 0.08);
            overflow-y: auto;
            min-height: 450px;
            max-height: 650px;
        }

        /* æ»šåŠ¨æ¡ç¾åŒ–å‡çº§ */
        .chat-window::-webkit-scrollbar {
            width: 7px;
        }
        .chat-window::-webkit-scrollbar-thumb {
            background-color: #c1d9ff;
            border-radius: 4px;
            transition: background-color 0.3s ease;
        }
        .chat-window::-webkit-scrollbar-thumb:hover {
            background-color: #a3c1ff;
        }
        .chat-window::-webkit-scrollbar-track {
            background-color: #f8fbff;
        }

        /* æ¶ˆæ¯å®¹å™¨ - åŒ…å«å¤´åƒ+æ°”æ³¡ï¼Œå…³é”®å¸ƒå±€ */
        .msg-container {
            max-width: 80%;
            margin-bottom: 1.2rem;
            display: flex;
            align-items: flex-end;
            gap: 0.8rem;
        }

        /* å¤´åƒæ ·å¼ - åŒæ–¹ä¸“å±ï¼Œåœ†å½¢å¸¦è¾¹æ¡† */
        .msg-avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            flex-shrink: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            border: 2px solid #f0f7ff;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        /* ç”¨æˆ·å¤´åƒ - å³ä¾§æ¶ˆæ¯ï¼Œè“è‰²ç³» */
        .user-avatar {
            background-color: #4a90e2;
            color: #fff;
        }
        /* å°ç›ˆå¤´åƒ - å·¦ä¾§æ¶ˆæ¯ï¼Œæµ…è“ç³» */
        .ai-avatar {
            background-color: #e8f4ff;
            color: #4a90e2;
        }

        /* æ¶ˆæ¯æ°”æ³¡é€šç”¨ - ä¼˜åŒ–å†…è¾¹è·å’Œåœ†è§’ */
        .message {
            padding: 0.9rem 1.3rem;
            border-radius: 20px;
            line-height: 1.6;
            font-size: 0.95rem;
            position: relative;
            word-wrap: break-word;
        }

        /* ç”¨æˆ·æ¶ˆæ¯ - å³å¯¹é½ï¼Œè“è‰²æ°”æ³¡ï¼Œå¤´åƒåœ¨å³ */
        .user-msg-wrap {
            margin-left: auto;
            flex-direction: row-reverse; /* å¤´åƒåœ¨æ°”æ³¡å³ä¾§ */
        }
        .user-msg {
            background-color: #4a90e2;
            color: #fff;
            border-bottom-right-radius: 6px;
        }

        /* å°ç›ˆæ¶ˆæ¯ - å·¦å¯¹é½ï¼Œæµ…è“æ°”æ³¡ï¼Œå¤´åƒåœ¨å·¦ */
        .ai-msg-wrap {
            margin-right: auto;
        }
        .ai-msg {
            background-color: #e8f4ff;
            color: #333;
            border-bottom-left-radius: 6px;
        }

        /* åŠ è½½åŠ¨ç”» - é€‚é…å¤´åƒå¸ƒå±€ */
        .loading-wrap {
            margin-right: auto;
            display: flex;
            align-items: center;
            gap: 0.8rem;
        }
        .loading {
            display: flex;
            gap: 4px;
            padding: 0.9rem 1rem;
            background-color: #e8f4ff;
            border-radius: 20px;
            border-bottom-left-radius: 6px;
        }
        .loading-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background-color: #4a90e2;
            animation: bounce 1s infinite alternate;
        }
        .loading-dot:nth-child(2) {
            animation-delay: 0.2s;
        }
        .loading-dot:nth-child(3) {
            animation-delay: 0.4s;
        }
        @keyframes bounce {
            from { transform: translateY(0); }
            to { transform: translateY(-6px); }
        }

        /* è¾“å…¥æ¡†åŒºåŸŸ - ä¼˜åŒ–åœ†è§’å’Œé˜´å½± */
        .input-area {
            display: flex;
            gap: 0.8rem;
            align-items: center;
            background-color: #fff;
            padding: 0.9rem 1.4rem;
            border-radius: 36px;
            box-shadow: 0 0 20px rgba(74, 144, 226, 0.08);
        }

        #msg-input {
            flex: 1;
            border: none;
            outline: none;
            background: transparent;
            font-size: 0.95rem;
            color: #333;
            resize: none;
            min-height: 20px;
            max-height: 120px;
            overflow-y: auto;
            padding: 0.3rem 0;
        }

        #msg-input::placeholder {
            color: #b0c4de;
        }

        .send-btn {
            width: 38px;
            height: 38px;
            border-radius: 50%;
            background-color: #4a90e2;
            color: #fff;
            border: none;
            outline: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
            box-shadow: 0 2px 8px rgba(74, 144, 226, 0.3);
        }

        .send-btn:disabled {
            background-color: #d0e1ff;
            cursor: not-allowed;
            box-shadow: none;
        }

        .send-btn:hover:not(:disabled) {
            background-color: #357bd8;
            transform: scale(1.05);
            box-shadow: 0 3px 10px rgba(74, 144, 226, 0.4);
        }

        /* ä¾§è¾¹æ  - æ”¶çª„å®½åº¦ï¼Œè¾…åŠ©å¸ƒå±€ */
        .sidebar {
            flex: 1; /* ä¸èŠå¤©åŒº4:1æ¯”ä¾‹ï¼Œæ›´ç´§å‡‘ */
            min-width: 280px;
            display: flex;
            flex-direction: column;
            gap: 1.2rem;
        }

        /* å°ç›ˆå½¢è±¡å¡ç‰‡ - ä¼˜åŒ–æ¸å˜å’Œé˜´å½± */
        .ai-card {
            background: linear-gradient(135deg, #e8f4ff, #d0e1ff);
            border-radius: 20px;
            padding: 1.5rem;
            text-align: center;
            box-shadow: 0 0 20px rgba(74, 144, 226, 0.12);
            border: 1px solid rgba(255,255,255,0.8);
        }

        .ai-card-avatar {
            width: 90px;
            height: 90px;
            border-radius: 50%;
            background-color: #fff;
            margin: 0 auto 1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.2rem;
            color: #4a90e2;
            border: 4px solid #4a90e2;
            box-shadow: 0 3px 10px rgba(74, 144, 226, 0.2);
        }

        .ai-name {
            font-size: 1.3rem;
            font-weight: 700;
            color: #4a90e2;
            margin-bottom: 0.6rem;
            letter-spacing: 0.5px;
        }

        .ai-desc {
            font-size: 0.9rem;
            color: #666;
            line-height: 1.5;
        }

        /* æƒ…ç»ªåˆ†ææŠ¥å‘Šæ¨¡å— - ä¼˜åŒ–å†…è¾¹è·å’Œåœ†è§’ */
        .emotion-report {
            background-color: #fff;
            border-radius: 20px;
            padding: 1.5rem;
            box-shadow: 0 0 20px rgba(74, 144, 226, 0.08);
            flex: 1;
            border: 1px solid rgba(240,247,255,0.8);
        }

        .report-title {
            font-size: 1.15rem;
            font-weight: 700;
            color: #4a90e2;
            margin-bottom: 1.2rem;
            display: flex;
            align-items: center;
            gap: 0.6rem;
        }

        .report-title i {
            font-size: 1.3rem;
        }

        /* æƒ…ç»ªæŒ‡æ•°è¿›åº¦æ¡ - ä¼˜åŒ–æ ·å¼ */
        .emotion-score {
            margin-bottom: 1.5rem;
        }

        .score-label {
            display: flex;
            justify-content: space-between;
            font-size: 0.9rem;
            color: #666;
            margin-bottom: 0.6rem;
        }

        .score-bar {
            width: 100%;
            height: 10px;
            background-color: #f0f5ff;
            border-radius: 5px;
            overflow: hidden;
            box-shadow: inset 0 1px 2px rgba(0,0,0,0.05);
        }

        .score-fill {
            height: 100%;
            background: linear-gradient(90deg, #ff8a8a, #4a90e2);
            border-radius: 5px;
            width: 60%;
            transition: width 0.8s ease-in-out;
            box-shadow: 0 0 5px rgba(74, 144, 226, 0.3);
        }

        /* æƒ…ç»ªæ ‡ç­¾ - ä¼˜åŒ–åœ†è§’å’Œé…è‰² */
        .emotion-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 0.6rem;
            margin-bottom: 1.5rem;
        }

        .emotion-tag {
            padding: 0.4rem 1rem;
            background-color: #e8f4ff;
            color: #4a90e2;
            border-radius: 24px;
            font-size: 0.85rem;
            border: 1px solid #d0e1ff;
        }

        /* åˆ†æå’Œå»ºè®® - ä¼˜åŒ–è¡Œé«˜ */
        .emotion-analysis, .emotion-suggest {
            margin-bottom: 1.2rem;
            font-size: 0.95rem;
            line-height: 1.6;
        }

        .analysis-label, .suggest-label {
            font-weight: 700;
            color: #4a90e2;
            margin-bottom: 0.4rem;
            display: block;
        }

        /* ç©ºçŠ¶æ€æç¤º - ä¼˜åŒ–æ ·å¼ */
        .empty-tip {
            text-align: center;
            color: #999;
            font-size: 1rem;
            padding: 4rem 0;
            line-height: 1.8;
        }

        .empty-tip i {
            font-size: 2.5rem;
            margin-bottom: 0.8rem;
            display: block;
            color: #c1d9ff;
        }

        /* åº•éƒ¨ç‰ˆæƒ - å›ºå®šåº•éƒ¨ï¼Œå°å­—æ ‡æ˜ */
        .copyright {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 40px;
            background-color: #fff;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.85rem;
            color: #999;
            border-top: 1px solid #f0f7ff;
            z-index: 90;
        }

        /* å“åº”å¼é€‚é… - å…¨å°ºå¯¸å…¼å®¹ */
        @media (max-width: 768px) {
            .main-container {
                flex-direction: column;
                margin: 0.8rem auto;
                gap: 1rem;
            }

            .sidebar {
                width: 100%;
                min-width: unset;
            }

            .chat-window {
                min-height: 350px;
                max-height: 500px;
                padding: 1rem 1.2rem;
            }

            .msg-container {
                max-width: 85%;
                gap: 0.6rem;
            }

            .msg-avatar {
                width: 32px;
                height: 32px;
                font-size: 1rem;
            }

            .message {
                padding: 0.8rem 1.2rem;
                font-size: 0.9rem;
            }

            .header h1 {
                font-size: 1.4rem;
            }

            .ai-card-avatar {
                width: 80px;
                height: 80px;
                font-size: 2rem;
            }

            .copyright {
                font-size: 0.8rem;
                padding: 0 1rem;
                text-align: center;
            }
        }

        @media (max-width: 480px) {
            .msg-container {
                max-width: 90%;
            }

            .input-area {
                padding: 0.8rem 1.2rem;
            }

            .send-btn {
                width: 36px;
                height: 36px;
            }
        }
    </style>
    <!-- å¼•å…¥å­—ä½“å›¾æ ‡ -->
    <link rel="stylesheet" href="https://cdn.bootcdn.net/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <!-- é¡¶éƒ¨å¯¼èˆªæ  - ç§»é™¤AIæ ‘æ´æ–‡å­— -->
    <header class="header">
        <h1>å¿ƒçµé¿é£æ¸¯</h1>
        <p>å°ç›ˆé™ªä½ å€¾è¯‰æ‰€æœ‰å¿ƒäº‹ï¼Œåšä½ æœ€æ¸©æš–çš„å€¾å¬è€…</p>
    </header>

    <!-- ä¸»å®¹å™¨ - èŠå¤©æ¡†å ä¸»ä½“ -->
    <main class="main-container">
        <!-- èŠå¤©åŒºåŸŸ - ä¸»ä½“å æ¯” -->
        <section class="chat-section">
            <!-- èŠå¤©çª—å£ - æ˜¾ç¤ºåŒæ–¹å¤´åƒ -->
            <div class="chat-window" id="chat-window">
                <div class="empty-tip" id="empty-tip">
                    <i class="fas fa-comments"></i>
                    ä½ å¥½å‘€ï½æˆ‘æ˜¯å°ç›ˆ ğŸ˜Š<br>
                    æœ‰ä»€ä¹ˆå¿ƒäº‹æƒ³å’Œæˆ‘è¯´å—ï¼Ÿæˆ‘ä¼šè®¤çœŸå€¾å¬çš„
                </div>
            </div>

            <!-- è¾“å…¥æ¡†åŒºåŸŸ -->
            <div class="input-area">
                <textarea id="msg-input" placeholder="è¾“å…¥æƒ³å€¾è¯‰çš„å†…å®¹ï¼ŒæŒ‰å›è½¦å‘é€..." rows="1"></textarea>
                <button class="send-btn" id="send-btn" disabled>
                    <i class="fas fa-paper-plane"></i>
                </button>
            </div>
        </section>

        <!-- ä¾§è¾¹æ ï¼šå°ç›ˆå½¢è±¡ + æƒ…ç»ªåˆ†ææŠ¥å‘Šï¼ˆè¾…åŠ©å¸ƒå±€ï¼‰ -->
        <aside class="sidebar">
            <!-- å°ç›ˆå½¢è±¡å¡ç‰‡ -->
            <div class="ai-card">
                <div class="ai-card-avatar">
                    <i class="fas fa-girl"></i>
                </div>
                <h3 class="ai-name">å°ç›ˆ</h3>
                <p class="ai-desc">ä½ çš„ä¸“å±å¿ƒçµå€¾å¬è€…<br>æ¸©æŸ”Â·è€å¿ƒÂ·ä¿å¯†<br>é™ªä½ åº¦è¿‡æ¯ä¸€ä¸ªæƒ…ç»ªæ—¶åˆ»</p>
            </div>

            <!-- æƒ…ç»ªåˆ†ææŠ¥å‘Š -->
            <div class="emotion-report">
                <h3 class="report-title">
                    <i class="fas fa-chart-line"></i>
                    æƒ…ç»ªåˆ†ææŠ¥å‘Š
                </h3>
                <div class="emotion-score">
                    <div class="score-label">
                        <span>æƒ…ç»ªæŒ‡æ•°</span>
                        <span id="emotion-score-num">60</span>/100
                    </div>
                    <div class="score-bar">
                        <div class="score-fill" id="score-fill"></div>
                    </div>
                </div>
                <div class="emotion-tags" id="emotion-tags">
                    <span class="emotion-tag">å¹³é™</span>
                    <span class="emotion-tag">æœŸå¾…</span>
                </div>
                <div class="emotion-analysis">
                    <span class="analysis-label">æƒ…ç»ªåˆ†æï¼š</span>
                    <span id="emotion-analysis">å½“å‰æœªæ£€æµ‹åˆ°æ˜æ˜¾çš„è´Ÿé¢æƒ…ç»ªï¼Œå¿ƒæ€å¤„äºå¹³å’Œçš„çŠ¶æ€ï¼Œå¯¹äº¤æµæŠ±æœ‰è½»å¾®æœŸå¾…ã€‚</span>
                </div>
                <div class="emotion-suggest">
                    <span class="suggest-label">æš–å¿ƒå»ºè®®ï¼š</span>
                    <span id="emotion-suggest">ä¿æŒè¿™ä»½å¹³å’Œçš„å¿ƒæƒ…ï¼Œå¤§èƒ†è¯´å‡ºä½ çš„æƒ³æ³•å§ï¼Œæˆ‘ä¼šä¸€ç›´åœ¨è¿™é‡Œé™ªç€ä½ ï½</span>
                </div>
            </div>
        </aside>
    </main>

    <!-- åº•éƒ¨ç‰ˆæƒ - å›ºå®šåº•éƒ¨ï¼Œå°å­—æ ‡æ˜ -->
    <div class="copyright">
        ç‰ˆæƒæ‰€æœ‰-JSHTæ·æ€æ…§å›¾ç§‘æŠ€ ç¿»ç‰ˆå¿…ç©¶
    </div>

    <script>
        // è·å–DOMå…ƒç´ 
        const chatWindow = document.getElementById('chat-window');
        const msgInput = document.getElementById('msg-input');
        const sendBtn = document.getElementById('send-btn');
        const emptyTip = document.getElementById('empty-tip');
        const emotionScoreNum = document.getElementById('emotion-score-num');
        const scoreFill = document.getElementById('score-fill');
        const emotionTags = document.getElementById('emotion-tags');
        const emotionAnalysis = document.getElementById('emotion-analysis');
        const emotionSuggest = document.getElementById('emotion-suggest');

        // å°ç›ˆé¢„è®¾å›å¤åº“ï¼ˆæŒ‰æƒ…ç»ªåˆ†ç±»ï¼‰
        const aiReplies = {
            happy: [
                "å¤ªä¸ºä½ å¼€å¿ƒå•¦ï½å¬åˆ°ä½ æœ‰å¼€å¿ƒçš„äº‹ï¼Œæˆ‘ä¹Ÿè·Ÿç€å¿ƒæƒ…å˜å¥½ğŸ˜†",
                "çœŸå¥½å‘€ï¼èƒ½åˆ†äº«ä¸€ä¸‹å…·ä½“æ˜¯ä»€ä¹ˆäº‹è®©ä½ è¿™ä¹ˆå¼€å¿ƒå—ï¼Ÿæˆ‘è¶…æƒ³å¬çš„ï½",
                "å¼€å¿ƒçš„æƒ…ç»ªæœ€æœ‰æ„ŸæŸ“åŠ›äº†ï¼Œå¸Œæœ›è¿™ä»½å¿«ä¹ä¸€ç›´é™ªç€ä½ ğŸ¥³"
            ],
            sad: [
                "æŠ±æŠ±ä½ ğŸ«‚ ä¸€å®šå¾ˆéš¾å—å§ï¼Œæ²¡å…³ç³»ï¼Œæƒ³å“­å°±å“­ï¼Œæƒ³è¯´è¯´å°±è¯´ï¼Œæˆ‘éƒ½åœ¨ã€‚",
                "å¬ä½ è¿™ä¹ˆè¯´ï¼Œæˆ‘ä¹Ÿè§‰å¾—å¿ƒé‡Œé…¸é…¸çš„ï¼Œæ„¿æ„å’Œæˆ‘è¯´è¯´å…·ä½“å‘ç”Ÿäº†ä»€ä¹ˆå—ï¼Ÿ",
                "éš¾è¿‡çš„æ—¶å€™ä¸ç”¨ç¡¬æ’‘ï¼Œæˆ‘ä¼šä¸€ç›´å½“ä½ çš„æƒ…ç»ªåƒåœ¾æ¡¶ï¼Œæ…¢æ…¢è¯´ï½"
            ],
            anxious: [
                "èƒ½æ„Ÿå—åˆ°ä½ çš„ç„¦è™‘ğŸ˜Ÿ åˆ«ç€æ€¥ï¼Œäº‹æƒ…æ€»ä¼šæ…¢æ…¢å˜å¥½çš„ï¼Œæˆ‘ä»¬ä¸€æ­¥ä¸€æ­¥æ¥ã€‚",
                "ç„¦è™‘çš„æ—¶å€™è¯•ç€æ·±å‘¼å¸ï¼ŒæŠŠçƒ¦å¿ƒäº‹è¯´å‡ºæ¥ï¼Œä¼šè½»æ¾å¾ˆå¤šçš„ï¼Œæˆ‘å¬ç€ï½",
                "æˆ‘çŸ¥é“ä½ ç°åœ¨å¾ˆç€æ€¥ï¼Œä½†æ˜¯å…ˆåˆ«æ…Œï¼Œè¯´è¯´è®©ä½ ç„¦è™‘çš„äº‹æƒ…ï¼Œæˆ‘ä»¬ä¸€èµ·æ‹ä¸€æ‹ï½"
            ],
            angry: [
                "æŠ±æŠ±ä½ ğŸ«‚ è‚¯å®šæ˜¯é‡åˆ°ç‰¹åˆ«è®©äººä¸èˆ’æœçš„äº‹äº†ï¼Œæ‰ä¼šè¿™ä¹ˆç”Ÿæ°”å§ã€‚",
                "ç”Ÿæ°”å°±è¯´å‡ºæ¥ï¼Œåˆ«æ†‹åœ¨å¿ƒé‡Œï¼ŒæŠŠä¸å¼€å¿ƒéƒ½å‘æ³„ç»™æˆ‘ï¼Œæˆ‘æ¥ç€ï½",
                "èƒ½æ„Ÿå—åˆ°ä½ çš„æ„¤æ€’ï¼Œæ²¡å…³ç³»ï¼Œå°½æƒ…åæ§½ï¼Œæˆ‘æ°¸è¿œç«™åœ¨ä½ è¿™è¾¹ï½"
            ],
            normal: [
                "å—¯å—¯ï¼Œæˆ‘å¬ç€å‘¢ï½ğŸ˜Œ",
                "åŸæ¥æ˜¯è¿™æ ·ï¼Œé‚£æ¥ä¸‹æ¥å‘¢ï¼Ÿ",
                "æˆ‘æ‡‚ä½ çš„æ„æ€å•¦ï¼Œè¿˜æœ‰ä»€ä¹ˆæƒ³è¯´è¯´çš„å—ï¼Ÿ",
                "è°¢è°¢ä½ æ„¿æ„å’Œæˆ‘è¯´è¿™äº›ï½"
            ]
        };

        // æƒ…ç»ªå…³é”®è¯åº“ï¼ˆç”¨äºç®€å•æƒ…ç»ªè¯†åˆ«ï¼‰
        const emotionKeywords = {
            happy: ["å¼€å¿ƒ", "å¿«ä¹", "é«˜å…´", "å¹¸ç¦", "æ£’", "å¤ªå¥½äº†", "ç¾æ»‹æ»‹", "å¼€å¿ƒæäº†"],
            sad: ["éš¾è¿‡", "ä¼¤å¿ƒ", "æƒ³å“­", "å§”å±ˆ", "å­¤å•", "å¯‚å¯", "å¤±è½", "ä¸å¼€å¿ƒ"],
            anxious: ["ç„¦è™‘", "ç€æ€¥", "ç´§å¼ ", "æ‹…å¿ƒ", "å®³æ€•", "æƒ¶æ", "ä¸å®‰", "å‹åŠ›å¤§"],
            angry: ["ç”Ÿæ°”", "æ„¤æ€’", "æ¼ç«", "çƒ¦", "è®¨åŒ", "æ°”æ­»äº†", "ä¸çˆ½"]
        };

        // ç›‘å¬è¾“å…¥æ¡†å˜åŒ–ï¼Œæ§åˆ¶å‘é€æŒ‰é’®çŠ¶æ€+è‡ªé€‚åº”é«˜åº¦
        msgInput.addEventListener('input', () => {
            const content = msgInput.value.trim();
            sendBtn.disabled = content === '';
            // è‡ªé€‚åº”è¾“å…¥æ¡†é«˜åº¦
            msgInput.style.height = 'auto';
            msgInput.style.height = Math.min(msgInput.scrollHeight, 120) + 'px';
        });

        // å›è½¦å‘é€ï¼ˆæŒ‰ä½shift+å›è½¦æ¢è¡Œï¼‰
        msgInput.addEventListener('keydown', (e) => {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                sendMessage();
            }
        });

        // ç‚¹å‡»å‘é€æŒ‰é’®
        sendBtn.addEventListener('click', sendMessage);

        // å‘é€æ¶ˆæ¯æ ¸å¿ƒå‡½æ•°
        function sendMessage() {
            const content = msgInput.value.trim();
            if (content === '') return;

            // 1. æ·»åŠ ç”¨æˆ·æ¶ˆæ¯ï¼ˆå¸¦å¤´åƒï¼‰åˆ°èŠå¤©çª—å£
            addMessage(content, 'user');
            // 2. æ¸…ç©ºè¾“å…¥æ¡†å¹¶æ¢å¤é«˜åº¦
            msgInput.value = '';
            msgInput.style.height = 'auto';
            sendBtn.disabled = true;
            // 3. éšè—ç©ºçŠ¶æ€æç¤º
            emptyTip.style.display = 'none';
            // 4. æ˜¾ç¤ºåŠ è½½åŠ¨ç”»ï¼ˆå¸¦å°ç›ˆå¤´åƒï¼‰
            showLoading();
            // 5. æ¨¡æ‹ŸAIæ€è€ƒï¼ˆ1-2ç§’åå›å¤ï¼‰
            setTimeout(() => {
                // ç§»é™¤åŠ è½½åŠ¨ç”»
                removeLoading();
                // è¯†åˆ«ç”¨æˆ·æƒ…ç»ª
                const emotion = recognizeEmotion(content);
                // ç”ŸæˆAIå›å¤
                const aiReply = getAiReply(emotion);
                // æ·»åŠ AIå›å¤ï¼ˆå¸¦å¤´åƒï¼‰åˆ°èŠå¤©çª—å£
                addMessage(aiReply, 'ai', emotion);
                // æ›´æ–°æƒ…ç»ªåˆ†ææŠ¥å‘Š
                updateEmotionReport(emotion, content);
            }, Math.random() * 1000 + 1000);
        }

        // æ·»åŠ æ¶ˆæ¯åˆ°èŠå¤©çª—å£ï¼ˆæ ¸å¿ƒï¼šå¸¦åŒæ–¹å¤´åƒï¼‰
        function addMessage(content, type, emotion = 'normal') {
            // åˆ›å»ºæ¶ˆæ¯å®¹å™¨ï¼ˆå¤´åƒ+æ°”æ³¡ï¼‰
            const msgContainer = document.createElement('div');
            // åˆ›å»ºå¤´åƒå…ƒç´ 
            const avatar = document.createElement('div');
            // åˆ›å»ºæ¶ˆæ¯æ°”æ³¡
            const messageDiv = document.createElement('div');

            // åŒºåˆ†ç”¨æˆ·/AIæ¶ˆæ¯çš„æ ·å¼å’Œå†…å®¹
            if (type === 'user') {
                // ç”¨æˆ·æ¶ˆæ¯ï¼šå®¹å™¨å³å¯¹é½ã€å¤´åƒè“è‰²ï¼ˆç”¨æˆ·ï¼‰ã€æ°”æ³¡è“è‰²
                msgContainer.className = 'msg-container user-msg-wrap';
                avatar.className = 'msg-avatar user-avatar';
                avatar.innerHTML = '<i class="fas fa-user"></i>';
                messageDiv.className = 'message user-msg';
            } else {
                // AIæ¶ˆæ¯ï¼šå®¹å™¨å·¦å¯¹é½ã€å¤´åƒæµ…è“ï¼ˆå°ç›ˆï¼‰ã€æ°”æ³¡æµ…è“
                msgContainer.className = 'msg-container ai-msg-wrap';
                avatar.className = 'msg-avatar ai-avatar';
                avatar.innerHTML = '<i class="fas fa-girl"></i>';
                messageDiv.className = 'message ai-msg';
                messageDiv.dataset.emotion = emotion;
            }

            // ç»„è£…æ¶ˆæ¯ç»“æ„ï¼šå®¹å™¨ -> å¤´åƒ + æ°”æ³¡
            messageDiv.innerText = content;
            msgContainer.appendChild(avatar);
            msgContainer.appendChild(messageDiv);
            chatWindow.appendChild(msgContainer);

            // è‡ªåŠ¨æ»šåŠ¨åˆ°æœ€æ–°æ¶ˆæ¯
            chatWindow.scrollTop = chatWindow.scrollHeight;

            // AIæ¶ˆæ¯æ·»åŠ æ‰“å­—æœºæ•ˆæœ
            if (type === 'ai') {
                typingEffect(messageDiv, content);
            }
        }

        // æ‰“å­—æœºæ•ˆæœ
        function typingEffect(element, text) {
            element.innerText = '';
            let index = 0;
            const timer = setInterval(() => {
                element.innerText += text[index];
                index++;
                if (index >= text.length) {
                    clearInterval(timer);
                }
                // æ»šåŠ¨åˆ°æœ€æ–°å†…å®¹
                chatWindow.scrollTop = chatWindow.scrollHeight;
            }, 30);
        }

        // æ˜¾ç¤ºåŠ è½½åŠ¨ç”»ï¼ˆå¸¦å°ç›ˆå¤´åƒï¼Œé€‚é…å¸ƒå±€ï¼‰
        function showLoading() {
            const loadingWrap = document.createElement('div');
            const avatar = document.createElement('div');
            const loadingDiv = document.createElement('div');

            loadingWrap.className = 'loading-wrap';
            avatar.className = 'msg-avatar ai-avatar';
            avatar.innerHTML = '<i class="fas fa-girl"></i>';
            loadingDiv.className = 'loading';
            loadingDiv.id = 'loading-animation';
            loadingDiv.innerHTML = `
                <div class="loading-dot"></div>
                <div class="loading-dot"></div>
                <div class="loading-dot"></div>
            `;

            loadingWrap.appendChild(avatar);
            loadingWrap.appendChild(loadingDiv);
            chatWindow.appendChild(loadingWrap);
            chatWindow.scrollTop = chatWindow.scrollHeight;
        }

        // ç§»é™¤åŠ è½½åŠ¨ç”»
        function removeLoading() {
            const loading = document.getElementById('loading-animation');
            if (loading) loading.parentElement.remove();
        }

        // ç®€å•æƒ…ç»ªè¯†åˆ«ï¼ˆåŸºäºå…³é”®è¯åŒ¹é…ï¼‰
        function recognizeEmotion(text) {
            for (const [emotion, keywords] of Object.entries(emotionKeywords)) {
                for (const keyword of keywords) {
                    if (text.includes(keyword)) {
                        return emotion;
                    }
                }
            }
            return 'normal';
        }

        // è·å–AIéšæœºå›å¤
        function getAiReply(emotion) {
            const replies = aiReplies[emotion];
            return replies[Math.floor(Math.random() * replies.length)];
        }

        // æ›´æ–°æƒ…ç»ªåˆ†ææŠ¥å‘Šæ ¸å¿ƒå‡½æ•°
        function updateEmotionReport(emotion, content) {
            // 1. ç”Ÿæˆæƒ…ç»ªæŒ‡æ•°ï¼ˆä¸åŒæƒ…ç»ªå¯¹åº”ä¸åŒåŸºç¡€æŒ‡æ•°ï¼ŒåŠ éšæœºæ³¢åŠ¨ï¼‰
            let baseScore = 60; // å¹³é™ä¸ºåŸºç¡€åˆ†
            switch (emotion) {
                case 'happy': baseScore = 85; break;
                case 'sad': baseScore = 30; break;
                case 'anxious': baseScore = 40; break;
                case 'angry': baseScore = 25; break;
                default: baseScore = 60;
            }
            // æŒ‡æ•°æ³¢åŠ¨Â±5ï¼Œä¿è¯åœ¨0-100ä¹‹é—´
            const finalScore = Math.max(0, Math.min(100, baseScore + Math.floor(Math.random() * 11) - 5));
            emotionScoreNum.innerText = finalScore;
            scoreFill.style.width = finalScore + '%';

            // 2. æ›´æ–°æƒ…ç»ªæ ‡ç­¾
            const emotionTagMap = {
                happy: ["å¼€å¿ƒ", "æ„‰æ‚¦", "ç§¯æ"],
                sad: ["éš¾è¿‡", "ä½è½", "å§”å±ˆ"],
                anxious: ["ç„¦è™‘", "ç´§å¼ ", "æ‹…å¿§"],
                angry: ["ç”Ÿæ°”", "çƒ¦èº", "ä¸æ»¡"],
                normal: ["å¹³é™", "å¹³å’Œ", "æ·¡ç„¶"]
            };
            const tags = emotionTagMap[emotion];
            emotionTags.innerHTML = '';
            tags.forEach(tag => {
                const tagSpan = document.createElement('span');
                tagSpan.className = 'emotion-tag';
                tagSpan.innerText = tag;
                emotionTags.appendChild(tagSpan);
            });

            // 3. æ›´æ–°æƒ…ç»ªåˆ†æ
            const analysisMap = {
                happy: `æ£€æµ‹åˆ°å¼ºçƒˆçš„æ­£é¢æƒ…ç»ªï¼Œä½ å½“å‰å¤„äºå¼€å¿ƒæ„‰æ‚¦çš„çŠ¶æ€ï¼Œè¿™ä»½ç§¯æçš„å¿ƒæ€ç‰¹åˆ«çè´µï½`,
                sad: `æ£€æµ‹åˆ°è´Ÿé¢æƒ…ç»ªï¼Œä½ ç°åœ¨æ„Ÿåˆ°éš¾è¿‡ä½è½ï¼Œå¿ƒé‡Œä¸€å®šè—ç€ä¸å°‘å§”å±ˆå§ã€‚`,
                anxious: `æ£€æµ‹åˆ°ç„¦è™‘æƒ…ç»ªï¼Œä½ å½“å‰å¤„äºç´§å¼ æ‹…å¿§çš„çŠ¶æ€ï¼Œä¼¼ä¹æœ‰çƒ¦å¿ƒäº‹è®©ä½ æ”¾ä¸ä¸‹ã€‚`,
                angry: `æ£€æµ‹åˆ°æ„¤æ€’æƒ…ç»ªï¼Œä½ ç°åœ¨æ„Ÿåˆ°çƒ¦èºä¸æ»¡ï¼Œè‚¯å®šæ˜¯é‡åˆ°äº†è®©ä½ ä¸èˆ’æœçš„äº‹æƒ…ã€‚`,
                normal: `æœªæ£€æµ‹åˆ°æ˜æ˜¾çš„æç«¯æƒ…ç»ªï¼Œä½ å½“å‰å¿ƒæ€å¹³å’Œï¼Œå¤„äºæ”¾æ¾çš„çŠ¶æ€ã€‚`
            };
            emotionAnalysis.innerText = analysisMap[emotion];

            // 4. æ›´æ–°æš–å¿ƒå»ºè®®
            const suggestMap = {
                happy: `ç»§ç»­ä¿æŒè¿™ä»½å¼€å¿ƒå‘€ï¼å¦‚æœæœ‰æ›´å¤šå¿«ä¹çš„å°äº‹ï¼Œä¸€å®šè¦ç»§ç»­å’Œæˆ‘åˆ†äº«ï¼Œè®©å¿«ä¹åŠ å€ï½`,
                sad: `æŠ±æŠ±ä½ ğŸ«‚ éš¾è¿‡çš„æ—¶å€™ä¸ç”¨å‡è£…åšå¼ºï¼ŒæŠŠå¿ƒé‡Œçš„å§”å±ˆéƒ½å€’å‡ºæ¥å§ï¼Œæˆ‘ä¼šä¸€ç›´é™ªç€ä½ ï¼Œç›´åˆ°ä½ å¿ƒæƒ…å˜å¥½ã€‚`,
                anxious: `è¯•ç€æ”¾æ…¢è„šæ­¥ï¼Œåˆ«ç»™è‡ªå·±å¤ªå¤§å‹åŠ›ï½æŠŠè®©ä½ ç„¦è™‘çš„äº‹æƒ…æ‹†è§£å¼€ï¼Œä¸€æ­¥ä¸€æ­¥æ¥ï¼Œä¸€åˆ‡éƒ½ä¼šæ…¢æ…¢å˜å¥½çš„ï¼Œæˆ‘é™ªç€ä½ ã€‚`,
                angry: `åˆ«è®©åæƒ…ç»ªå½±å“è‡ªå·±å¤ªä¹…å•¦ï½æŠŠè®©ä½ ç”Ÿæ°”çš„äº‹æƒ…å°½æƒ…åæ§½å‡ºæ¥ï¼Œå‘æ³„å®Œå°±æ”¾ä¸‹å§ï¼Œä¸å€¼å¾—ä¸ºå°äº‹ç”Ÿæ°”ï½`,
                normal: `è¿™ç§å¹³å’Œçš„çŠ¶æ€çœŸçš„å¾ˆå¥½ï½ä¸ç®¡æ˜¯æƒ³éšä¾¿èŠèŠæ—¥å¸¸ï¼Œè¿˜æ˜¯æœ‰å°æƒ³æ³•æƒ³å€¾è¯‰ï¼Œæˆ‘éƒ½åœ¨è¿™é‡Œè®¤çœŸå¬ç€ï½`
            };
            emotionSuggest.innerText = suggestMap[emotion];
        }
    </script>
</body>
</html>
